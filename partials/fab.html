<!-- =======================================================
 ⚙️ FAB Menu - Enhanced with Background Selector
 File: partials/fab.html
 Author: Saleh Abedinezhad (ImSalione)
 
 Features:
 - Theme toggle (dark/light)
 - Language toggle (FA/EN)
 - Color palette selector
 - Background selector ✨ NEW
======================================================= -->

<div id="fabMenu" role="menu" aria-label="Settings Menu">
  <!-- Main FAB Button -->
  <button
    id="fabMain"
    class="fab-button"
    aria-label="Open Settings"
    aria-expanded="false"
    aria-haspopup="menu"
  >
    <i class="fas fa-cog" aria-hidden="true"></i>
  </button>

  <!-- Submenu Options -->
  <div id="fabSubmenu" class="fab-submenu" role="menu">
    <!-- ✨ NEW: Background Toggle -->
    <button
      id="backgroundToggle"
      class="fab-option"
      aria-label="Change Background"
      aria-haspopup="menu"
      title="Background"
      tabindex="0"
    >
      <i class="fas fa-image" aria-hidden="true"></i>
    </button>

    <!-- Palette Toggle -->
    <button
      id="paletteToggle"
      class="fab-option"
      aria-label="Change Color Palette"
      aria-haspopup="menu"
      title="Color Palette"
      tabindex="0"
    >
      <i class="fas fa-palette" aria-hidden="true"></i>
    </button>

    <!-- Theme Toggle -->
    <button
      id="themeToggle"
      class="fab-option"
      aria-label="Toggle Dark/Light Theme"
      title="Toggle Theme"
      tabindex="0"
    >
      <i class="fas fa-moon" aria-hidden="true"></i>
    </button>

    <!-- Language Toggle -->
    <button
      id="langToggle"
      class="fab-option"
      aria-label="Change Language"
      title="Change Language"
      tabindex="0"
    >
      <span class="fab-option-text">EN</span>
    </button>
  </div>

  <!-- Palette Submenu -->
  <div
    id="fabPalette"
    class="fab-palette-menu"
    role="menu"
    aria-label="Color Palettes"
  >
    <!-- Default Palette -->
    <button
      class="color-swatch"
      data-color="default"
      aria-label="Default Palette"
      title="Default"
      role="menuitemradio"
      aria-checked="true"
      tabindex="0"
      style="background: linear-gradient(135deg, #6366f1, #8b5cf6)"
    ></button>

    <!-- Ocean Palette -->
    <button
      class="color-swatch"
      data-color="ocean"
      aria-label="Ocean Palette"
      title="Ocean"
      role="menuitemradio"
      aria-checked="false"
      tabindex="0"
      style="background: linear-gradient(135deg, #0ea5e9, #06b6d4)"
    ></button>

    <!-- Forest Palette -->
    <button
      class="color-swatch"
      data-color="forest"
      aria-label="Forest Palette"
      title="Forest"
      role="menuitemradio"
      aria-checked="false"
      tabindex="0"
      style="background: linear-gradient(135deg, #10b981, #14b8a6)"
    ></button>

    <!-- Sunset Palette -->
    <button
      class="color-swatch"
      data-color="sunset"
      aria-label="Sunset Palette"
      title="Sunset"
      role="menuitemradio"
      aria-checked="false"
      tabindex="0"
      style="background: linear-gradient(135deg, #f59e0b, #ef4444)"
    ></button>

    <!-- Rose Palette -->
    <button
      class="color-swatch"
      data-color="rose"
      aria-label="Rose Palette"
      title="Rose"
      role="menuitemradio"
      aria-checked="false"
      tabindex="0"
      style="background: linear-gradient(135deg, #ec4899, #f43f5e)"
    ></button>

    <!-- Violet Palette -->
    <button
      class="color-swatch"
      data-color="violet"
      aria-label="Violet Palette"
      title="Violet"
      role="menuitemradio"
      aria-checked="false"
      tabindex="0"
      style="background: linear-gradient(135deg, #8b5cf6, #a855f7)"
    ></button>

    <!-- Mono Palette -->
    <button
      class="color-swatch"
      data-color="mono"
      aria-label="Monochrome Palette"
      title="Mono"
      role="menuitemradio"
      aria-checked="false"
      tabindex="0"
      style="background: linear-gradient(135deg, #6b7280, #4b5563)"
    ></button>

    <!-- Neon Palette -->
    <button
      class="color-swatch"
      data-color="neon"
      aria-label="Neon Palette"
      title="Neon"
      role="menuitemradio"
      aria-checked="false"
      tabindex="0"
      style="background: linear-gradient(135deg, #a855f7, #06b6d4)"
    ></button>
  </div>

  <!-- ✨ NEW: Background Submenu -->
  <div
    id="fabBackground"
    class="fab-background-menu"
    role="menu"
    aria-label="Backgrounds"
  >
    <!-- Backgrounds will be dynamically generated -->
  </div>
</div>

<!-- Keyboard Navigation Script -->
<script>
  // Enhanced keyboard navigation for FAB menu
  (function setupFabKeyboardNav() {
    'use strict';

    const fabMenu = document.getElementById('fabMenu');
    if (!fabMenu) return;

    const focusableElements = fabMenu.querySelectorAll(
      'button[tabindex="0"], .color-swatch[tabindex="0"], .background-preview[tabindex="0"]'
    );

    let currentIndex = -1;

    // Handle arrow key navigation
    fabMenu.addEventListener('keydown', (e) => {
      if (!['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
        return;
      }

      e.preventDefault();

      const elements = Array.from(focusableElements);
      
      if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
        currentIndex = (currentIndex + 1) % elements.length;
      } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
        currentIndex = (currentIndex - 1 + elements.length) % elements.length;
      }

      elements[currentIndex]?.focus();
    });

    // Handle Enter/Space on color swatches and backgrounds
    fabMenu.querySelectorAll('.color-swatch, .background-preview').forEach((item) => {
      item.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          item.click();
        }
      });
    });

    console.log('✅ [FAB] Keyboard navigation ready');
  })();
</script>